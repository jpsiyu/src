%% --------------------------------------------------------
%% @Module:           |pt_403
%% @Author:           |Wu Zhenhua
%% @Email:            |45517168@qq.com
%% @Created:          |2012-00-00
%% @Description:      |帮派协议处理(补)
%% --------------------------------------------------------

-module(pt_403).
-export([read/2, write/2]).
-include("record.hrl").
-include("guild.hrl").

-define(SEPARATOR_STRING, "【】").

%%%=========================================================================
%%% 协议接收解包
%%%=========================================================================

%% -----------------------------------------------------------------
%% 获取自己的福利信息
%% -----------------------------------------------------------------
read(40320, <<GuildId:32>>) ->
    {ok, [GuildId]};

%% -----------------------------------------------------------------
%% 获取自己的福利信息
%% -----------------------------------------------------------------
read(40321, _) ->
    {ok, 40321};

%% -----------------------------------------------------------------
%% 领取自己的福利信息
%% -----------------------------------------------------------------
read(40322, <<UseType:16>>) ->
    {ok, [UseType]};

%% -----------------------------------------------------------------
%% 捐献给帮派建筑物
%% -----------------------------------------------------------------
read(40331, <<BuildType:16, CoinNum:32>>) ->
    {ok, [BuildType, CoinNum]};

%% -----------------------------------------------------------------
%% 获取单个帮派建筑物信息
%% -----------------------------------------------------------------
read(40332, <<BuildType:16>>) ->
    {ok, [BuildType]};

%% -----------------------------------------------------------------
%% 捐献给帮派建筑物
%% -----------------------------------------------------------------
read(40333, <<BuildType:16, CoinNum:32>>) ->
    {ok, [BuildType, CoinNum]};

%% -----------------------------------------------------------------
%% 获取个人财富
%% -----------------------------------------------------------------
read(40335, _) ->
    {ok, 40335};

%% -----------------------------------------------------------------
%% 获取自己帮派的关系列表
%% -----------------------------------------------------------------
read(40340, _) ->
    {ok, 40340};

%% -----------------------------------------------------------------
%% 更改与指定帮派的关系
%% -----------------------------------------------------------------
read(40341, <<TGuildId:32, Type:8>>) ->
    {ok, [TGuildId, Type]};

%% -----------------------------------------------------------------
%% 更改与指定帮派的关系
%% -----------------------------------------------------------------
read(40343, <<TGuildId:32, Type:8>>) ->
    {ok, [TGuildId, Type]};

%% %% -----------------------------------------------------------------
%% %% 解除异常帮派关系
%% %% -----------------------------------------------------------------
%% read(40345, _) ->
%%     {ok, [40345]};
%% 
%% %% -----------------------------------------------------------------
%% %% 解除异常帮派关系
%% %% -----------------------------------------------------------------
%% read(40346, <<Type:8>>) ->
%%     {ok, [Type]};

%% -----------------------------------------------------------------
%% 查询神兽信息(新)
%% -----------------------------------------------------------------
read(40350, _) ->
    {ok, 40350};

%% -----------------------------------------------------------------
%% 捐献给帮派神兽
%% -----------------------------------------------------------------
read(40351, <<Num:32>>) ->
    {ok, [Num]};

%% -----------------------------------------------------------------
%% 查看申请加入帮派设置
%% -----------------------------------------------------------------
read(40352, _) ->
    {ok, []};

%% -----------------------------------------------------------------
%% 设置申请加入帮派设置
%% -----------------------------------------------------------------
read(40353, <<Type:8, Level:8, Power:32>>) ->
    {ok, [Type, Level, Power]};

%% -----------------------------------------------------------------
%% 错误处理
%% -----------------------------------------------------------------
read(_Cmd, _R) ->
    {error, no_match}.

%%%=========================================================================
%%% 协议发送打包
%%%=========================================================================

%% -----------------------------------------------------------------
%% 取消帮派申请
%% -----------------------------------------------------------------
write(40320, [Res]) ->
    Data = <<Res:8>>,
    {ok, pt:pack(40320, Data)};

%% -----------------------------------------------------------------
%% 获取自己的福利信息
%% -----------------------------------------------------------------
write(40321, [DoToday, List]) ->
    Bin = pack_40321(List),
    Data = <<DoToday:32, Bin/binary>>,
    {ok, pt:pack(40321, Data)};

%% -----------------------------------------------------------------
%% 领取自己的福利信息
%% -----------------------------------------------------------------
write(40322, [Res, Num]) ->
    Data = <<Res:8, Num:16>>,
    {ok, pt:pack(40322, Data)};

%% -----------------------------------------------------------------
%% 捐献给帮派建筑物
%% -----------------------------------------------------------------
write(40331, [Res]) ->
    Data = <<Res:8>>,
    {ok, pt:pack(40331, Data)};

%% -----------------------------------------------------------------
%% 获取单个帮派建筑物信息
%% -----------------------------------------------------------------
write(40332, [Res, Threshold, CCNow, CoinNeed, BuildType, BuildLevel]) ->
    Data = <<Res:8, Threshold:32, CCNow:32, CoinNeed:32, BuildType:16, BuildLevel:16>>,
    {ok, pt:pack(40332, Data)};

%% -----------------------------------------------------------------
%% 捐献给帮派建筑物
%% -----------------------------------------------------------------
write(40333, [Res]) ->
    Data = <<Res:8>>,
    {ok, pt:pack(40333, Data)};

%% -----------------------------------------------------------------
%% 获取人物财富
%% -----------------------------------------------------------------
write(40335, [Res, Chaifu]) ->
    Data = <<Res:8, Chaifu:32>>,
    {ok, pt:pack(40335, Data)};

%% -----------------------------------------------------------------
%% 获取自己帮派的关系列表
%% -----------------------------------------------------------------
write(40340, [Res, FList, EList]) ->
	BinFList = pack_40340(FList),
	BinEList = pack_40340(EList),
    Data = <<Res:8, BinFList/binary, BinEList/binary>>,
    {ok, pt:pack(40340, Data)};

%% -----------------------------------------------------------------
%% 更改与指定帮派的关系
%% -----------------------------------------------------------------
write(40341, [Res, Type]) ->
    Data = <<Res:8, Type:8>>,
    {ok, pt:pack(40341, Data)};

%% -----------------------------------------------------------------
%% 同盟申请(敌对提示)
%% -----------------------------------------------------------------
write(40342, [Res, GuildId, GuildName, GuildLv, GuildNum, R]) ->
	BinGuildName = pt:write_string(GuildName),
    Data = <<Res:8, GuildId:32, BinGuildName/binary, GuildLv:32, GuildNum:32, R:8>>,
    {ok, pt:pack(40342, Data)};

%% -----------------------------------------------------------------
%% 同盟申请回应
%% -----------------------------------------------------------------
write(40343, [Res]) ->
    Data = <<Res:8>>,
    {ok, pt:pack(40343, Data)};

%% -----------------------------------------------------------------
%% 帮派关系改变提示
%% -----------------------------------------------------------------
write(40344, [Res, GuildName]) ->
	BinGuildName = pt:write_string(GuildName),
    Data = <<Res:8, BinGuildName/binary>>,
    {ok, pt:pack(40344, Data)};

%% -----------------------------------------------------------------
%% 查询神兽信息(新)
%% -----------------------------------------------------------------
write(40350, [GALV, GAStage, GAStageExp, Mid]) ->
    Data = <<GALV:32, GAStage:32, GAStageExp:32, Mid:32>>,
    {ok, pt:pack(40350, Data)};

%% -----------------------------------------------------------------
%% 捐献给帮派神兽
%% -----------------------------------------------------------------
write(40351, [Res]) ->
    Data = <<Res:8>>,
    {ok, pt:pack(40351, Data)};

%% -----------------------------------------------------------------
%% 查看申请加入帮派设置
%% -----------------------------------------------------------------
write(40352, [Type, Level, Power]) ->
    Data = <<Type:8, Level:8, Power:32>>,
    {ok, pt:pack(40352, Data)};

%% -----------------------------------------------------------------
%% 设置申请加入帮派设置
%% -----------------------------------------------------------------
write(40353, [Res]) ->
    Data = <<Res:8>>,
    {ok, pt:pack(40353, Data)};

%% -----------------------------------------------------------------
%% 错误处理
%% -----------------------------------------------------------------
write(_Cmd, _R) ->
    {ok, pt:pack(0, <<>>)}.


%% -----------------------------------------------------------------------------
%% *****************************************************************************
%% 		 打包区_对各种内容比较复杂的协议进行打包
%% *****************************************************************************
%% -----------------------------------------------------------------------------

%% -----------------------------------------------------------------
%% 打包40321
%% -----------------------------------------------------------------
pack_40321([]) ->
    <<0:16, <<>>/binary>>;
pack_40321(List) ->
    Rlen = length(List),
    F = fun({PackageId, TimesLeft, IsC}) ->
        <<PackageId:16, TimesLeft:16, IsC:16>>
    end,
    RB = list_to_binary([F(D) || D <- List]),
    <<Rlen:16, RB/binary>>.

%% -----------------------------------------------------------------
%% 打包40340
%% -----------------------------------------------------------------
pack_40340([]) ->
    <<0:16, <<>>/binary>>;
pack_40340(List) ->
    Rlen = length(List),
    F = fun(GuildId) ->
        <<GuildId:32>>
    end,
    RB = list_to_binary([F(D) || D <- List]),
    <<Rlen:16, RB/binary>>.

%% -----------------------------------------------------------------------------
%% *****************************************************************************
%% 		 代码整理区
%% *****************************************************************************
%% -----------------------------------------------------------------------------
