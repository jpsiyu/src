%% --------------------------------------------------------
%% @Module:           |pt_400
%% @Author:           |Wu Zhenhua
%% @Email:            |45517168@qq.com
%% @Created:          |2012-00-00
%% @Description:      |帮派协议处理
%% --------------------------------------------------------

-module(pt_400).
-export([read/2, write/2]).
-include("record.hrl").
-include("guild.hrl").

-define(SEPARATOR_STRING, "【】").

%%%=========================================================================
%%% 解包函数
%%%=========================================================================

%% -----------------------------------------------------------------
%% 创建帮派
%% -----------------------------------------------------------------
read(40001, <<UseType:8, Bin/binary>>) ->
    {GuildName, Bin1} = pt:read_string(Bin),
    {GuildTenet, _} = pt:read_string(Bin1),
    {ok, [UseType, GuildName, GuildTenet]};

%% -----------------------------------------------------------------
%% 解散帮派
%% -----------------------------------------------------------------
read(40002, <<GuildId:32>>) ->
    {ok, [GuildId]};

%% -----------------------------------------------------------------
%% 解散确认
%% -----------------------------------------------------------------
read(40003, <<GuildID:32, ConfirmResult:16>>) ->
    {ok, [GuildID, ConfirmResult]};

%% -----------------------------------------------------------------
%% 申请加入
%% -----------------------------------------------------------------
read(40004, <<GuildId:32>>) ->
    {ok, [GuildId]};

%% -----------------------------------------------------------------
%% 审批加入
%% -----------------------------------------------------------------
read(40005, <<PlayerId:32, HandleResult:16>>) ->
    {ok, [PlayerId, HandleResult]};

%% -----------------------------------------------------------------
%% 邀请加入
%% -----------------------------------------------------------------
read(40006, <<Bin/binary>>) ->
    {PlayerName, _} = pt:read_string(Bin),
    {ok, [PlayerName]};

%% -----------------------------------------------------------------
%% 邀请回应
%% -----------------------------------------------------------------
read(40007, <<GuildId:32, ResponseResult:16>>) ->
    {ok, [GuildId, ResponseResult]};

%% -----------------------------------------------------------------
%% 踢出帮派
%% -----------------------------------------------------------------
read(40008, <<PlayerId:32>>) ->
    {ok, [PlayerId]};

%% -----------------------------------------------------------------
%% 退出帮派
%% -----------------------------------------------------------------
read(40009, <<GuildId:32>>) ->
    {ok, [GuildId]};

%% -----------------------------------------------------------------
%% 帮派列表
%% -----------------------------------------------------------------
read(40010, <<PageSize:16, PageNo:16>>) ->
    {ok, [PageSize, PageNo]};

%% -----------------------------------------------------------------
%% 成员列表
%% -----------------------------------------------------------------
read(40011, D) ->
	<<GuildId:32, PageSize:16, PageNo:16, Type:16>> = D,
    {ok, [GuildId, PageSize, PageNo, Type]};

%% -----------------------------------------------------------------
%% 申请列表
%% -----------------------------------------------------------------
read(40012, <<GuildId:32, PageSize:16, PageNo:16>>) ->
    {ok, [GuildId, PageSize, PageNo]};

%% -----------------------------------------------------------------
%% 邀请列表
%% -----------------------------------------------------------------
read(40013, <<PlayerId:32, PageSize:16, PageNo:16>>) ->
    {ok, [PlayerId, PageSize, PageNo]};

%% -----------------------------------------------------------------
%% 帮派信息
%% -----------------------------------------------------------------
read(40014, <<GuildId:32>>) ->
    {ok, [GuildId]};

%% -----------------------------------------------------------------
%% 修改帮派宗旨
%% -----------------------------------------------------------------
read(40015, <<GuildId:32, Bin/binary>>) ->
    {Tenet, _} = pt:read_string(Bin),
    {ok, [GuildId, Tenet]};

%% -----------------------------------------------------------------
%% 修改帮派公告
%% -----------------------------------------------------------------
read(40016, <<GuildId:32, Bin/binary>>) ->
    {Announce, _} = pt:read_string(Bin),
    {ok, [GuildId, Announce]};

%% -----------------------------------------------------------------
%% 职位设置
%% -----------------------------------------------------------------
read(40017, <<PlayerId:32, GuildPosition:16>>) ->
    {ok, [PlayerId, GuildPosition]};

%% -----------------------------------------------------------------
%% 禅让帮主
%% -----------------------------------------------------------------
read(40018, <<Bin/binary>>) ->
    {PlayerName, _} = pt:read_string(Bin),
    {ok, [PlayerName]};

%% -----------------------------------------------------------------
%% 捐献帮派金
%% -----------------------------------------------------------------
read(40019, <<GuildId:32, Num:32>>) ->
    {ok, [GuildId, Num]};

%% -----------------------------------------------------------------
%% 捐献建设卡
%% -----------------------------------------------------------------
read(40020, <<GuildId:32, Num:32>>) ->
    {ok, [GuildId, Num]};

%% -----------------------------------------------------------------
%% 获取捐献列表
%% -----------------------------------------------------------------
read(40021, <<GuildId:32, PageSize:16, PageNo:16>>) ->
    {ok, [GuildId, PageSize, PageNo]};

%% -----------------------------------------------------------------
%% 辞去官职
%% -----------------------------------------------------------------
read(40022, <<GuildId:32>>) ->
    {ok, [GuildId]};

%% -----------------------------------------------------------------
%% 领取日福利
%% -----------------------------------------------------------------
read(40023, <<GuildId:32>>) ->
    {ok, [GuildId]};

%% -----------------------------------------------------------------
%% 获取成员信息
%% -----------------------------------------------------------------
read(40024, <<GuildId:32, PlayerId:32>>) ->
    {ok, [GuildId,PlayerId]};

%% -----------------------------------------------------------------
%% 授予头衔
%% -----------------------------------------------------------------
read(40025, <<GuildId:32, PlayerId:32, Bin/binary>>) ->
    {Title, _} = pt:read_string(Bin),
    {ok, [GuildId, PlayerId, Title]};

%% -----------------------------------------------------------------
%% 修改个人备注
%% -----------------------------------------------------------------
read(40026, <<GuildId:32, Bin/binary>>) ->
    {Remark, _} = pt:read_string(Bin),
    {ok, [GuildId, Remark]};

%% -----------------------------------------------------------------
%% 获取仓库物品列表
%% -----------------------------------------------------------------
read(40027, <<GuildId:32>>) ->
    {ok, [GuildId]};

%% -----------------------------------------------------------------
%% 帮派仓库存入物品
%% -----------------------------------------------------------------
read(40028, <<GuildId:32, GoodsId:32, GoodsNum:16, Bin/binary>>) ->
    {GoodsName, _} = pt:read_string(Bin),
    {ok, [GuildId, GoodsId, GoodsName, GoodsNum]};

%% -----------------------------------------------------------------
%% 帮派仓库取出物品
%% -----------------------------------------------------------------
read(40029, <<GuildId:32, GoodsId:32, GoodsNum:16, Bin/binary>>) ->
    {GoodsName, _} = pt:read_string(Bin),
    {ok, [GuildId, GoodsId, GoodsName, GoodsNum]};

%% -----------------------------------------------------------------
%% 帮派仓库删除物品
%% -----------------------------------------------------------------
read(40030, <<GuildId:32, GoodsId:32, GoodsNum:16, Bin/binary>>) ->
    {GoodsName, _} = pt:read_string(Bin),
    {ok, [GuildId, GoodsId, GoodsName, GoodsNum]};

%% -----------------------------------------------------------------
%% 升级帮派建筑
%% -----------------------------------------------------------------
read(40031, <<GuildId:32, BuildType:8>>) ->
    {ok, [GuildId, BuildType]};

%% -----------------------------------------------------------------
%% 查询帮派
%% -----------------------------------------------------------------
read(40034, <<Realm:16, Bin/binary>>) ->
    {GuildName, Bin1} = pt:read_string(Bin),
    {ChiefName, Bin2} = pt:read_string(Bin1),
    <<PageSize:16, PageNo:16, WashType:8, SelfShow:8>> = Bin2,
    {ok, [Realm, GuildName, ChiefName, PageSize, PageNo, WashType, SelfShow]};

%% -----------------------------------------------------------------
%% 进入帮派大厅_场景
%% -----------------------------------------------------------------
read(40035, <<Type:8>>) ->
    {ok, Type};

%% -----------------------------------------------------------------
%% 查询帮派成员上次帮战战功列表
%% -----------------------------------------------------------------
read(40037, _) ->
    {ok, []};

%% -----------------------------------------------------------------
%% 查询帮派战功
%% -----------------------------------------------------------------
read(40038, _) ->
    {ok, []};

%% -----------------------------------------------------------------
%% 合服改名
%% -----------------------------------------------------------------
read(40039, <<GuildId:32, Bin/binary>>) ->
    {GuildName, _} = pt:read_string(Bin),
    {ok, [GuildId, GuildName]};

%% -----------------------------------------------------------------
%% 获取奖励物品列表
%% -----------------------------------------------------------------
read(40040, _) ->
    {ok, guild_award_list};

%% -----------------------------------------------------------------
%% 分配奖励物品
%% -----------------------------------------------------------------
read(40041, <<PlayerId:32, Num:16, Bin/binary>>) ->
    F = fun(_, [Bin1,L]) ->
        <<GoodsId:32, GoodsNum:16, Score:16, Rest/binary>> = Bin1,
        L1 = [{GoodsId,GoodsNum,Score}|L],
        [Rest, L1]
    end,
    [_, GoodsList] = lists:foldl(F, [Bin,[]], lists:seq(1, Num)),
    {ok, [PlayerId, GoodsList]};

%% -----------------------------------------------------------------
%% 取消返回奖励物品
%% -----------------------------------------------------------------
read(40042, <<PlayerId:32, Id:32>>) ->
    {ok, [PlayerId, Id]};

%% -----------------------------------------------------------------
%% 领取奖励物品
%% -----------------------------------------------------------------
read(40043, <<Id:32>>) ->
    {ok, Id};

%% -----------------------------------------------------------------
%% 获取成員奖励物品列表
%% -----------------------------------------------------------------
read(40044, _) ->
    {ok, member_award_list};



%% -----------------------------------------------------------------
%% 查询帮派成员战功列表
%% -----------------------------------------------------------------
read(40048, _) ->
    {ok, []};


%% -----------------------------------------------------------------
%% 查询帮派成员战功列表
%% -----------------------------------------------------------------
read(40050, _) ->
    {ok, []};

%% -----------------------------------------------------------------
%% 使用弹劾令
%% -----------------------------------------------------------------
read(40052, <<GoodsId:32, GoodsUseNum:16>>) ->
    {ok, [GoodsId, GoodsUseNum]};

%% -----------------------------------------------------------------
%% 使用集结令
%% -----------------------------------------------------------------
read(40053, <<GoodsId:32, GoodsUseNum:16>>) ->
    {ok, [GoodsId, GoodsUseNum]};


%% -----------------------------------------------------------------
%% 获取帮派事件
%% -----------------------------------------------------------------
read(40055, <<Type:16, PageSize:16, PageNum:16>>) ->
    {ok, [Type, PageSize, PageNum]};

%% -----------------------------------------------------------------
%% 取消合并邀请
%% -----------------------------------------------------------------
read(40057, <<Type:8>>) ->
    {ok, [Type]};

%% -----------------------------------------------------------------
%% 合并邀请
%% -----------------------------------------------------------------
read(40058, _) ->
    {ok, 40058};

%% -----------------------------------------------------------------
%% 合并邀请回应
%% -----------------------------------------------------------------
read(40059, _) ->
    {ok, 40059};

%% -----------------------------------------------------------------
%% 合并邀请
%% -----------------------------------------------------------------
read(40060, <<TargetGuildId:32>>) ->
    {ok, [TargetGuildId]};

%% -----------------------------------------------------------------
%% 合并邀请回应
%% -----------------------------------------------------------------
read(40061, <<GuildId:32, ResponseResult:8>>) ->
    {ok, [GuildId, ResponseResult]};

%% -----------------------------------------------------------------
%% 帮主召唤
%% -----------------------------------------------------------------
read(40062, <<Bin/binary>>) ->
    {Content, _} = pt:read_string(Bin),
    {ok, [Content]};

%% -----------------------------------------------------------------
%% 入帮祝福
%% -----------------------------------------------------------------
read(40063, <<PlayerId:32, Type:8, GoodsNum:32>>) ->
    {ok, [PlayerId, Type, GoodsNum]};

%% -----------------------------------------------------------------
%% 获取亲密度列表
%% ----------------------------------------------------------------
read(40067, _Bin) ->
    {ok, []};

%% -----------------------------------------------------------------
%% 获取个人帮派技能
%% ----------------------------------------------------------------
read(40070, <<GuildId:32, PlayerId:32>>) ->
    {ok, [GuildId, PlayerId]};

%% -----------------------------------------------------------------
%% 赠送祝福露
%% ----------------------------------------------------------------
read(40071, <<GoodsTypeId:32, GoodsNum:16, PlayerId:32>>) ->
    {ok, [GoodsTypeId, GoodsNum, PlayerId]};

%% -----------------------------------------------------------------
%% 元宝兑换财富
%% ----------------------------------------------------------------
read(40072, <<Gold:32>>) ->
    {ok, Gold};

%% -----------------------------------------------------------------
%% 请求帮派祭坛信息
%% ----------------------------------------------------------------
read(40078, <<GuildId:32>>) ->
    {ok, [GuildId]};

%% -----------------------------------------------------------------
%% 帮派祭坛祈福
%% ----------------------------------------------------------------
read(40079, <<GuildId:32, Artar_List_Id:32>>) ->
    {ok, [GuildId, Artar_List_Id]};

%% -----------------------------------------------------------------
%% 请求帮派神炉信息
%% ----------------------------------------------------------------
read(40080, <<GuildId:32>>) ->
    {ok, [GuildId]};

%% -----------------------------------------------------------------
%% 获取神炉铜币
%% ----------------------------------------------------------------
read(40083, _) ->
    {ok, 40083};

%% -----------------------------------------------------------------
%% 请求帮派目标信息
%% ----------------------------------------------------------------
read(40081, <<GuildId:32, Type:8>>) ->
    {ok, [GuildId, Type]};

%% -----------------------------------------------------------------
%% 帮派目标领奖
%% ----------------------------------------------------------------
read(40082, <<GuildId:32, Achieve_Id:16>>) ->
    {ok, [GuildId, Achieve_Id]};

%% -----------------------------------------------------------------
%% 获取帮派商城物品列表
%% -----------------------------------------------------------------
read(40091, <<GuildId:32, Mall_Level:16>>) ->
    {ok, [GuildId, Mall_Level]};

%% -----------------------------------------------------------------
%% 兑换帮派商城物品
%% -----------------------------------------------------------------
read(40092, <<GoodsType_Id:32, NUnitNum:16>>) ->
    {ok, [GoodsType_Id, NUnitNum]};

%% -----------------------------------------------------------------
%% 直接解散帮派
%% -----------------------------------------------------------------
read(40094, <<GuildId:32>>) ->
    {ok, [GuildId]};

%% -----------------------------------------------------------------
%% 帮派通讯录_请求读取
%% -----------------------------------------------------------------
read(40095, <<GuildId:32, PlayerId:32, PageSize:16, PageNum:16>>) ->
    {ok, [GuildId, PlayerId, PageSize, PageNum]};

%% -----------------------------------------------------------------
%% 帮派通讯录_修改
%% -----------------------------------------------------------------
read(40096, Bin) ->
	<<PlayerId:32 , Bin1/binary>> = Bin,
	{PlayerName, Bin2} = pt:read_string(Bin1),
	{City, Bin3} = pt:read_string(Bin2),
	{QQ, Bin4} = pt:read_string(Bin3),
	{PhoneNum, Bin5} = pt:read_string(Bin4),
	<<BirDay:32, HideType:8>> = Bin5,
    {ok, [PlayerId, PlayerName, City, QQ, PhoneNum, BirDay, HideType]};

%% -----------------------------------------------------------------
%% 帮主群发公告
%% -----------------------------------------------------------------
read(40097, Bin) ->
	<<GuildId:32, PlayerId:32, Bin1/binary>> = Bin,
	{PlayerName, Bin2} = pt:read_string(Bin1),
	{Title, Bin3} = pt:read_string(Bin2),
	{Content, _Bin4} = pt:read_string(Bin3),
    {ok, [GuildId, PlayerId, PlayerName, Title, Content]};

%% -----------------------------------------------------------------
%% 玩家上线获取帮派信息
%% -----------------------------------------------------------------
read(40099, _) ->
    {ok, login_guild};

%% -----------------------------------------------------------------
%% 错误处理
%% -----------------------------------------------------------------
read(_Cmd, _R) ->
    {error, no_match}.

%%%=========================================================================
%%% 组包函数
%%%=========================================================================

%% -----------------------------------------------------------------
%% 帮派公告通知（帮派群发）
%% -----------------------------------------------------------------
write(40000, Data) ->
	[H|T] = Data,
	Msg_Step_1 = pack_40000(T),
	Rlen = length(Msg_Step_1),
	Msg_Step_2 = case Rlen > 1 of
		true ->
			lists:concat(Msg_Step_1);
		false ->
			Msg_Step_1
	end,
    Msg = list_to_binary(Msg_Step_2),
    MsgInfo = pt:write_string(Msg),
	Datax = <<H:16, MsgInfo/binary>>,
    {ok, pt:pack(40000, Datax)};

%% -----------------------------------------------------------------
%% 创建帮派
%% -----------------------------------------------------------------
write(40001, [Code, GuildId, GuildName, GuildPosition, UseType, CoinLeft, BindCoinLeft]) ->
    GuildNameLen = byte_size(GuildName),
    Data = <<Code:16, GuildId:32, GuildNameLen:16, GuildName/binary, GuildPosition:16, UseType:8, CoinLeft:32, BindCoinLeft:32>>,
    {ok, pt:pack(40001, Data)};

%% -----------------------------------------------------------------
%% 解散帮派
%% -----------------------------------------------------------------
write(40002, Code) ->
    Data = <<Code:16>>,
    {ok, pt:pack(40002, Data)};

%% -----------------------------------------------------------------
%% 解散确认
%% -----------------------------------------------------------------
write(40003, [Code, GuildId, GuildName, ConfirmResult]) ->
    GuildNameLen = byte_size(GuildName),
    Data = <<Code:16, GuildId:32, GuildNameLen:16, GuildName/binary, ConfirmResult:16>>,
    {ok, pt:pack(40003, Data)};

%% -----------------------------------------------------------------
%% 申请加入
%% -----------------------------------------------------------------
write(40004, [Code, GuildId, ApplyGuildId]) ->
    Data = <<Code:16, GuildId:32, ApplyGuildId:32>>,
    {ok, pt:pack(40004, Data)};

%% -----------------------------------------------------------------
%% 审批加入
%% -----------------------------------------------------------------
write(40005, Code) ->
    Data = <<Code:16>>,
    {ok, pt:pack(40005, Data)};

%% -----------------------------------------------------------------
%% 邀请加入
%% -----------------------------------------------------------------
write(40006, Code) ->
    Data = <<Code:16>>,
    {ok, pt:pack(40006, Data)};

%% -----------------------------------------------------------------
%% 邀请回应
%% -----------------------------------------------------------------
write(40007, [Code, ResponseResult, GuildId, GuildName, GuildPosition]) ->
    GuildNameLen = byte_size(GuildName),
    Data = <<Code:16, ResponseResult:16, GuildId:32, GuildNameLen:16, GuildName/binary, GuildPosition:16>>,
    {ok, pt:pack(40007, Data)};

%% -----------------------------------------------------------------
%% 踢出帮派
%% -----------------------------------------------------------------
write(40008, Code) ->
    Data = <<Code:16>>,
    {ok, pt:pack(40008, Data)};

%% -----------------------------------------------------------------
%% 退出帮派
%% -----------------------------------------------------------------
write(40009, Code) ->
    Data = <<Code:16>>,
    {ok, pt:pack(40009, Data)};

%% -----------------------------------------------------------------
%% 门派列表
%% -----------------------------------------------------------------
write(40010, [Code, PageTotal, PageNo, RecordNum, Records]) ->
    Data = <<Code:16, PageTotal:16, PageNo:16, RecordNum:16, Records/binary>>,
    {ok, pt:pack(40010, Data)};

%% -----------------------------------------------------------------
%% 成员列表
%% -----------------------------------------------------------------
write(40011, [Code, PageTotal, PageNo, RecordNum, Records]) ->
    Data = <<Code:16, PageTotal:16, PageNo:16, RecordNum:16, Records/binary>>,
    {ok, pt:pack(40011, Data)};

%% -----------------------------------------------------------------
%% 申请列表
%% -----------------------------------------------------------------
write(40012, [Code, PageTotal, PageNo, RecordNum, Records]) ->
    Data = <<Code:16, PageTotal:16, PageNo:16, RecordNum:16, Records/binary>>,
    {ok, pt:pack(40012, Data)};

%% -----------------------------------------------------------------
%% 邀请列表
%% -----------------------------------------------------------------
write(40013, [Code, PageTotal, PageNo, RecordNum, Records]) ->
    Data = <<Code:16, PageTotal:16, PageNo:16, RecordNum:16, Records/binary>>,
    {ok, pt:pack(40013, Data)};

%% -----------------------------------------------------------------
%% 帮派信息
%% -----------------------------------------------------------------
write(40014, [Code, Bin]) ->
    Data = <<Code:16, Bin/binary>>,
    {ok, pt:pack(40014, Data)};

%% -----------------------------------------------------------------
%% 修改帮派宗旨
%% -----------------------------------------------------------------
write(40015, [Code, GuildId, Tenet]) ->
    TeneteLen = byte_size(Tenet),
    Data = <<Code:16, GuildId:32, TeneteLen:16, Tenet/binary>>,
    {ok, pt:pack(40015, Data)};

%% -----------------------------------------------------------------
%% 修改帮派公告
%% -----------------------------------------------------------------
write(40016, [Code, GuildId, Announce]) ->
    AnnounceLen = byte_size(Announce),
    Data = <<Code:16, GuildId:32, AnnounceLen:16, Announce/binary>>,
    {ok, pt:pack(40016, Data)};

%% -----------------------------------------------------------------
%% 职位设置
%% -----------------------------------------------------------------
write(40017, Code) ->
    Data = <<Code:16>>,
    {ok, pt:pack(40017, Data)};

%% -----------------------------------------------------------------
%% 禅让帮主
%% -----------------------------------------------------------------
write(40018, Code) ->
    Data = <<Code:8>>,
    {ok, pt:pack(40018, Data)};

%% -----------------------------------------------------------------
%% 捐献帮派金
%% -----------------------------------------------------------------
write(40019, [Code, CoinLeft, BindCoinLeft, DonationAdd, PaidAdd]) ->
    Data = <<Code:16, CoinLeft:32, BindCoinLeft:32, DonationAdd:32, PaidAdd:32>>,
    {ok, pt:pack(40019, Data)};

%% -----------------------------------------------------------------
%% 捐献建设卡
%% -----------------------------------------------------------------
write(40020, [Code, DonationAdd, PaidAdd, MetarialPlusCount, MetarialLeftCount]) ->
    Data = <<Code:16, DonationAdd:32, PaidAdd:32, MetarialPlusCount:32, MetarialLeftCount:32>>,
    {ok, pt:pack(40020, Data)};


%% -----------------------------------------------------------------
%% 获取捐献列表
%% -----------------------------------------------------------------
write(40021, [Code, PageTotal, PageNo, RecordNum, Records]) ->
    Data = <<Code:16, PageTotal:16, PageNo:16, RecordNum:16, Records/binary>>,
    {ok, pt:pack(40021, Data)};

%% -----------------------------------------------------------------
%% 辞去官职
%% -----------------------------------------------------------------
write(40022, Code) ->
    Data = <<Code:16>>,
    {ok, pt:pack(40022, Data)};

%% -----------------------------------------------------------------
%% 领取日福利
%% -----------------------------------------------------------------
write(40023, [Code, Num, BindCoinLeft]) ->
    Data = <<Code:16, Num:32, BindCoinLeft:32>>,
    {ok, pt:pack(40023, Data)};

%% -----------------------------------------------------------------
%% 获取成员信息
%% -----------------------------------------------------------------
write(40024, [Code, Bin]) ->
    Data = <<Code:16, Bin/binary>>,
    {ok, pt:pack(40024, Data)};

%% -----------------------------------------------------------------
%% 授予头衔
%% -----------------------------------------------------------------
write(40025, Code) ->
    Data = <<Code:16>>,
    {ok, pt:pack(40025, Data)};

%% -----------------------------------------------------------------
%% 修改个人备注
%% -----------------------------------------------------------------
write(40026, [Code, GuildId, Remark]) ->
    RemarkLen = byte_size(Remark),
    Data = <<Code:16, GuildId:32, RemarkLen:16, Remark/binary>>,
    {ok, pt:pack(40026, Data)};

%% -----------------------------------------------------------------
%% 获取仓库物品列表
%% -----------------------------------------------------------------
write(40027, [Code, RecordNum, Records]) ->
    Data = <<Code:16, RecordNum:16, Records/binary>>,
    {ok, pt:pack(40027, Data)};

%% -----------------------------------------------------------------
%% 帮派仓库存入物品
%% -----------------------------------------------------------------
write(40028, [Code, GuildId, GoodsId, GoodsNum]) ->
    Data = <<Code:16, GuildId:32, GoodsId:32, GoodsNum:16>>,
    {ok, pt:pack(40028, Data)};

%% -----------------------------------------------------------------
%% 帮派仓库取出物品
%% -----------------------------------------------------------------
write(40029, [Code, GuildId, DonationDeduct, GoodsId, GoodsNum]) ->
    Data = <<Code:16, GuildId:32, DonationDeduct:32, GoodsId:32, GoodsNum:16>>,
    {ok, pt:pack(40029, Data)};

%% -----------------------------------------------------------------
%% 帮派仓库删除物品
%% -----------------------------------------------------------------
write(40030, [Code, GuildId]) ->
    Data = <<Code:16, GuildId:32>>,
    {ok, pt:pack(40030, Data)};

%% -----------------------------------------------------------------
%% 升级帮派建筑
%% -----------------------------------------------------------------
write(40031, [Code, GuildId, OldLevel, NewLevel, UpgradeInfo]) ->
	Bin_UpgradeInfo = pt:write_string(UpgradeInfo),
    Data = <<Code:8, GuildId:32, OldLevel:16, NewLevel:16, Bin_UpgradeInfo/binary>>,
    {ok, pt:pack(40031, Data)};

%% -----------------------------------------------------------------
%% 查询帮派
%% -----------------------------------------------------------------
write(40034, [Code, ApplyGuildId, PageTotal, PageNo, RecordNum, Records]) ->
    Data = <<Code:16, ApplyGuildId:32, PageTotal:16, PageNo:16, RecordNum:16, Records/binary>>,
    {ok, pt:pack(40034, Data)};

%% -----------------------------------------------------------------
%% 进入帮派大厅_场景
%% -----------------------------------------------------------------
write(40035, [Code, HallEnterLeftTime]) ->
    Data = <<Code:16, HallEnterLeftTime:32>>,
    {ok, pt:pack(40035, Data)};

%% -----------------------------------------------------------------
%% 查询帮派成员上次帮战战功列表
%% -----------------------------------------------------------------
write(40037, [Result, RecordNum, Bin]) ->
    Data = <<Result:8, RecordNum:16, Bin/binary>>,
    {ok, pt:pack(40037, Data)};

%% -----------------------------------------------------------------
%% 查询帮派战功
%% -----------------------------------------------------------------
write(40038, [Result, Bin]) ->
    Data = <<Result:8, Bin/binary>>,
    {ok, pt:pack(40038, Data)};

%% -----------------------------------------------------------------
%% 合服改名
%% -----------------------------------------------------------------
write(40039, [Code, NewName]) ->
    NewNameLen = byte_size(NewName),
    Data = <<Code:16, NewNameLen:16, NewName/binary>>,
    {ok, pt:pack(40039, Data)};

%% -----------------------------------------------------------------
%% 获取奖励物品列表
%% -----------------------------------------------------------------
write(40040, [Res, GoodsList]) ->
    ListNum = length(GoodsList),
    F = fun({TypeId, GoodsNum, Score}) ->
            <<TypeId:32, GoodsNum:16, Score:16>>
        end,
    ListBin = list_to_binary(lists:map(F, GoodsList)),
    {ok, pt:pack(40040, <<Res:8, ListNum:16, ListBin/binary>>)};

%% -----------------------------------------------------------------
%% 分配奖励物品
%% -----------------------------------------------------------------
write(40041, Res) ->
    {ok, pt:pack(40041, <<Res:8>>)};

%% -----------------------------------------------------------------
%% 取消返回奖励物品
%% -----------------------------------------------------------------
write(40042, Res) ->
    {ok, pt:pack(40042, <<Res:8>>)};

%% -----------------------------------------------------------------
%% 领取奖励物品
%% -----------------------------------------------------------------
write(40043, Res) ->
    {ok, pt:pack(40043, <<Res:8>>)};

%% -----------------------------------------------------------------
%% 获取成員奖励物品列表
%% -----------------------------------------------------------------
write(40044, [Res, GoodsList]) ->
    ListNum = length(GoodsList),
    F = fun({Id,TypeId, GoodsNum, Score, PlayerId}) ->
            <<Id:32, TypeId:32, GoodsNum:16, Score:16, PlayerId:32>>
        end,
    ListBin = list_to_binary(lists:map(F, GoodsList)),
    {ok, pt:pack(40044, <<Res:8, ListNum:16, ListBin/binary>>)};

%% -----------------------------------------------------------------
%% 查询帮派成员战功列表
%% -----------------------------------------------------------------
write(40048, [Result, RecordNum, Bin]) ->
    Data = <<Result:8, RecordNum:16, Bin/binary>>,
    {ok, pt:pack(40048, Data)};

%% -----------------------------------------------------------------
%% 使用弹劾令
%% -----------------------------------------------------------------
write(40052, [Code]) ->
    Data = <<Code:16>>,
    {ok, pt:pack(40052, Data)};

%% -----------------------------------------------------------------
%% 使用集结令
%% -----------------------------------------------------------------
write(40053, [Code]) ->
    Data = <<Code:16>>,
    {ok, pt:pack(40053, Data)};

%% -----------------------------------------------------------------
%% 篝火加经验
%% -----------------------------------------------------------------
write(40054, [Time]) ->
    Data = <<Time:32>>,
    {ok, pt:pack(40054, Data)};
    
%% -----------------------------------------------------------------
%% 获取帮派事件
%% -----------------------------------------------------------------
write(40055, [Code, MenuType, PageTotle, PageNow, List]) ->
	Datax = pack_40055(List),
    Info = <<Code:8, MenuType:16, PageTotle:16, PageNow:16, Datax/binary>>,
    {ok, pt:pack(40055, Info)};

%% -----------------------------------------------------------------
%% 取消帮派合并申请
%% -----------------------------------------------------------------
write(40057, [Code]) ->
    Data = <<Code:8>>,
    {ok, pt:pack(40057, Data)};

%% -----------------------------------------------------------------
%% 合并邀请
%% -----------------------------------------------------------------
write(40058, [Code]) ->
    Data = <<Code:8>>,
    {ok, pt:pack(40058, Data)};

%% -----------------------------------------------------------------
%% 合并邀请
%% -----------------------------------------------------------------
write(40059, [Code, Gid, Glv, RecName, ZorB, GMN]) ->
	Name_b = pt:write_string(RecName),
    Data = <<Code:8, Gid:32, Glv:32, Name_b/binary, ZorB:8, GMN:32>>,
    {ok, pt:pack(40059, Data)};

%% -----------------------------------------------------------------
%% 合并邀请
%% -----------------------------------------------------------------
write(40060, [Code]) ->
    Data = <<Code:8>>,
    {ok, pt:pack(40060, Data)};

%% -----------------------------------------------------------------
%% 合并邀请回应
%% -----------------------------------------------------------------
write(40061, [Code]) ->
    Data = <<Code:8>>,
    {ok, pt:pack(40061, Data)};

%% -----------------------------------------------------------------
%% 帮主召唤
%% -----------------------------------------------------------------
write(40062, [Code, TimeLeft]) ->
    Data = <<Code:16, TimeLeft:32>>,
    {ok, pt:pack(40062, Data)};

%% -----------------------------------------------------------------
%% 合并邀请回应
%% -----------------------------------------------------------------
write(40063, [Code, Type, GoodsNum]) ->
    Data = <<Code:16, Type:8, GoodsNum:32>>,
    {ok, pt:pack(40063, Data)};


%% -----------------------------------------------------------------
%% 亲密度列表
%% ----------------------------------------------------------------
%        arrary(
%            Int32  角色id
%            Int16  等级
%            Int16  职位
%	     Int32  亲密度
%            Int16  性别
%            Int16  职业
%            Int8   线路
%            Int32  最后登录时间
%            Int16  头像
%            Int8   VIP类型
%            String 角色名称
%        )

write(40067, Members) ->
    F = fun(Member) ->
        RID  = Member#ets_guild_member.id,
        Lv   = Member#ets_guild_member.level,
        Pos  = Member#ets_guild_member.position,
        QinM = 0,
        Sex  = Member#ets_guild_member.sex,
        Realm = Member#ets_guild_member.career,
        Line  = Member#ets_guild_member.online_flag,
        Llog  = Member#ets_guild_member.last_login_time,
        Hand  = Member#ets_guild_member.image,
        Vip   = Member#ets_guild_member.vip,
        NameLen = byte_size(Member#ets_guild_member.name),
        Bname = Member#ets_guild_member.name,
        [<<RID:32, Lv:16, Pos:16, QinM:32, Sex:16, Realm:16, Line:8, Llog:32, Hand:16, Vip:8, NameLen:16, Bname/binary>>]
    end,
    List = lists:map(F, Members),
    Num = length(Members),
    BinData = list_to_binary(List),
    {ok, pt:pack(40067, <<Num:16, BinData/binary>>)};

%% -----------------------------------------------------------------
%% 获取个人帮派技能
%% ----------------------------------------------------------------
write(40070, [Result, Guild_Level, Player_bpgx, SkillList]) ->
    Bin = pack_40070(SkillList),
    {ok, pt:pack(40070, <<Result:8, Guild_Level:8, Player_bpgx:16, Bin/binary>>)};

%% -----------------------------------------------------------------
%% 赠送祝福露
%% ----------------------------------------------------------------
write(40071, [Res, GoodsTypeId, RecName, Point, MaterialAdd]) ->
    Name_b = pt:write_string(RecName),
    {ok, pt:pack(40071, <<Res:8, GoodsTypeId:32, Name_b/binary, Point:16, MaterialAdd:32>>)};

%% -----------------------------------------------------------------
%% 元宝兑换个人财富
%% ----------------------------------------------------------------
write(40072, [Res, DonationAdd, PaidAdd, Material, ContributionAdd]) ->
    {ok, pt:pack(40072, <<Res:8, DonationAdd:32, PaidAdd:32, Material:32, ContributionAdd:32>>)};

%% -----------------------------------------------------------------
%% 赠送祝福露通知
%% ----------------------------------------------------------------
write(40073, [Point, NickName]) ->
    Nick_b = pt:write_string(NickName),
    {ok, pt:pack(40073, <<Point:32, Nick_b/binary>>)};

%% -----------------------------------------------------------------
%% 增加个人财富
%% ----------------------------------------------------------------
write(40074, Material) ->
    {ok, pt:pack(40074, <<Material:32>>)};

%% -----------------------------------------------------------------
%% 获取帮派祭坛信息
%% ----------------------------------------------------------------
write(40078, [Code, GuildId, AltarLevel, PrayTimes, TimesLeft, FundsCost, ListId, GoodList]) ->
	Bin = pack_40078(GoodList),
    {ok, pt:pack(40078, <<Code:8, GuildId:32, AltarLevel:16, PrayTimes:16, TimesLeft:16, FundsCost:16, ListId:32, Bin/binary>>)};

%% -----------------------------------------------------------------
%% 帮派祭坛祈福
%% -----------------------------------------------------------------
write(40079, [Code, GuildId, PrayTimes, OrderNum, GoodsTypeID, GoodsNum]) ->
	Data = <<Code:8, GuildId:32, PrayTimes:16, OrderNum:8, GoodsTypeID:32, GoodsNum:16>>,
    {ok, pt:pack(40079, Data)};

%% -----------------------------------------------------------------
%% 请求帮派神炉信息1
%% ----------------------------------------------------------------
write(40080, [Code, GuildId, FurnaceLevel, NowAdd, _NextLvAdd, CNow, CTop]) ->
	Data = <<Code:8, GuildId:32, FurnaceLevel:16, NowAdd:16, 0:16, CNow:32, CTop:32>>,
    {ok, pt:pack(40080, Data)};

%% -----------------------------------------------------------------
%% 领取帮派神炉资金
%% ----------------------------------------------------------------
write(40083, [Result, Num]) ->
    {ok, pt:pack(40083, <<Result:8, Num:32>>)};

%% -----------------------------------------------------------------
%% 请求帮派目标信息
%% ----------------------------------------------------------------
write(40081, [Result, GuildId, AchieveList]) ->
	Bin = pack_40081(AchieveList),
    {ok, pt:pack(40081, <<Result:8, GuildId:32, Bin/binary>>)};

%% -----------------------------------------------------------------
%% 帮派目标领奖
%% ----------------------------------------------------------------
write(40082, [Result]) ->
    {ok, pt:pack(40082, <<Result:8>>)};

%% -----------------------------------------------------------------
%% 获取帮派商城物品列表
%% -----------------------------------------------------------------
write(40091, [Result, MallLevel, MallGoodsList, Caifu, FactionWarScore]) ->
    Bin = pack_40091(MallGoodsList),
    {ok, pt:pack(40091, <<Result:8, MallLevel:16, Caifu:32, FactionWarScore:32, Bin/binary>>)};

%% -----------------------------------------------------------------
%% 直接解散帮派
%% -----------------------------------------------------------------
write(40094, Code) ->
    Data = <<Code:16>>,
    {ok, pt:pack(40094, Data)};

%% -----------------------------------------------------------------
%% 兑换帮派商城物品
%% -----------------------------------------------------------------
write(40092, [Result, GoodsTypeId, GoodsNum, RestExchangeNum, Caifu, FactionWarScore]) ->
    {ok, pt:pack(40092, <<Result:8, GoodsTypeId:32, GoodsNum:16, RestExchangeNum:16, Caifu:32, FactionWarScore:32>>)};

%% -----------------------------------------------------------------
%% 帮派通讯录_请求读取
%% -----------------------------------------------------------------
write(40095, [GuildId, PageTotle, PageNow, List]) ->
	Datax = pack_40095(List),
    Info = <<GuildId:32, PageTotle:16, PageNow:16, Datax/binary>>,
    {ok, pt:pack(40095, Info)};

%% -----------------------------------------------------------------
%% 修改自己的帮派通讯录
%% -----------------------------------------------------------------
write(40096, [Type]) ->
    {ok, pt:pack(40096, <<Type:8>>)};

%% -----------------------------------------------------------------
%% 帮主群发公告
%% -----------------------------------------------------------------
write(40097, [Result]) ->
    {ok, pt:pack(40097, <<Result:8>>)};

%% -----------------------------------------------------------------
%% 今天已经退帮的提示
%% -----------------------------------------------------------------
write(40098, [Result]) ->
    {ok, pt:pack(40098, <<Result:8>>)};

%% -----------------------------------------------------------------
%% 玩家上线获取帮派信息
%% -----------------------------------------------------------------
write(40099, [GuildId, GuildName, GuildPosition]) ->
	Bin_GuildName = pt:write_string(GuildName),
    {ok, pt:pack(40099, <<GuildId:32, Bin_GuildName/binary, GuildPosition:16>>)};

%% -----------------------------------------------------------------
%% 错误处理
%% -----------------------------------------------------------------
write(_Cmd, _R) ->
    {ok, pt:pack(0, <<>>)}.




%% -----------------------------------------------------------------------------
%% *****************************************************************************
%% 		 打包区_对各种内容比较复杂的协议进行打包 
%% *****************************************************************************
%% -----------------------------------------------------------------------------


%% -----------------------------------------------------------------
%% 打包40000
%% -----------------------------------------------------------------
pack_40000([]) ->
    [];
pack_40000(List) ->
	[H|T] = List,
    H_F = case is_integer(H) of
		true->
			integer_to_list(H);
		false->
			H
	end,
	F = fun(Data_In) ->
        if 
			erlang:is_integer(Data_In) ->
				LSL = integer_to_list(Data_In),
				[?SEPARATOR_STRING, LSL];
			erlang:is_bitstring(Data_In) ->
				LSL = erlang:bitstring_to_list(Data_In),
				[?SEPARATOR_STRING, LSL];
			erlang:is_binary(Data_In)->
				LSL = erlang:binary_to_list(Data_In),
				[?SEPARATOR_STRING, LSL];
			erlang:is_list(Data_In)->
				[?SEPARATOR_STRING, Data_In];
			true ->
				[?SEPARATOR_STRING, []]
		end
    end,
	case T of
		[] ->
			H_F;
		_ ->
			RB = [F(D) || D <- T],
			[H_F|lists:append(RB)]
    end.

%% -----------------------------------------------------------------
%% 打包40055
%% -----------------------------------------------------------------
pack_40055([]) ->
    <<0:16, <<>>/binary>>;
pack_40055(List) ->
    Rlen = length(List),
    F = fun([EventTime,EventType,EventParam]) ->
        Bin_EventParam = pt:write_string(EventParam),
        <<EventTime:32, EventType:16, Bin_EventParam/binary>>
    end,
    RB = list_to_binary([F(D) || D <- List]),
    <<Rlen:16, RB/binary>>.


%% -----------------------------------------------------------------
%% 打包40070
%% -----------------------------------------------------------------
pack_40070([]) ->
    <<0:16, <<>>/binary>>;
pack_40070(List) ->
    Rlen = length(List),
    F = fun([Skill_Id, Skill_Level, Is_Active_Guild, Is_Active_Player, _]) ->
        		<<Skill_Id:32, Skill_Level:8, Is_Active_Guild:8, Is_Active_Player:8>>
    end,
    RB = list_to_binary([F(D) || D <- List]),
    <<Rlen:16, RB/binary>>.

%% -----------------------------------------------------------------
%% 打包40078
%% -----------------------------------------------------------------
pack_40078([]) ->
    <<0:16, <<>>/binary>>;
pack_40078(List) ->
    Rlen = length(List),
    F = fun({OrderNum, GoodId, GoodNum}) ->
        		<<OrderNum:8, GoodId:32, GoodNum:16>>
    end,
    RB = list_to_binary([F(D) || D <- List]),
    <<Rlen:16, RB/binary>>.

%% -----------------------------------------------------------------
%% 打包40081
%% -----------------------------------------------------------------
pack_40081([]) ->
    <<0:16, <<>>/binary>>;
pack_40081(List) ->
    Rlen = length(List),
    F = fun([_Guild_id, Achieved_type, _AchieveTime, IsAchieved, _GetPrize, Condition1_num, _Condition2_num, AchievedLevel]) ->
				Full_Achieved_Id = Achieved_type * 10 + AchievedLevel,
        		<<Full_Achieved_Id:32, IsAchieved:8, Condition1_num:16, 10:16>>
    end,
    RB = list_to_binary([F(D) || D <- List]),
    <<Rlen:16, RB/binary>>.

%% -----------------------------------------------------------------
%% 打包40091
%% -----------------------------------------------------------------
pack_40091([]) ->
    <<0:16, <<>>/binary>>;
pack_40091(List) ->
    Rlen = length(List),
    F = fun({GoodsTypeId, UnitGoodsCost, UnitGoodsType, _, MallDailyMaxNum, ExchangedNum, _, Lv_Limit}) ->
        <<GoodsTypeId:32, UnitGoodsCost:16, UnitGoodsType:8, MallDailyMaxNum:16, ExchangedNum:16, Lv_Limit:16>>
    end,
    RB = list_to_binary([F(D) || D <- List]),
    <<Rlen:16, RB/binary>>.

%% -----------------------------------------------------------------
%% 打包40095
%% -----------------------------------------------------------------
pack_40095([]) ->
    <<0:16, <<>>/binary>>;
pack_40095(List) ->
    Rlen = length(List),
    F = fun([PlayerId, _Gid, PlayerName, City, QQ, PhoneNum, BirDay, _HDT, Lv]) ->
        Bin_Name = pt:write_string(PlayerName),
		Bin_City = pt:write_string(City),
		Bin_QQ = pt:write_string(QQ),
		Bin_PhoneNum = pt:write_string(PhoneNum),
        <<PlayerId:32, Bin_Name/binary, Lv:16, Bin_City/binary, Bin_QQ/binary, Bin_PhoneNum/binary, _HDT:8, BirDay:32>>
    end,
    RB = list_to_binary([F(D) || D <- List]),
    <<Rlen:16, RB/binary>>.


